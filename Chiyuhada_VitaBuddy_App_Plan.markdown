# 앱 개발 계획서: 체중 트래커 및 아바타 애니메이션 앱 (Flutter 크로스플랫폼)

## 1. 프로젝트 개요
- **목적**: 사용자가 체중과 식사(칼로리)를 관리하고, 도트 아트 아바타와 칼로리 인디케이터가 연동된 애니메이션을 통해 동기부여를 제공하는 크로스플랫폼(안드로이드/iOS) 앱 개발. 아바타는 키와 체중에 따라 동적으로 변화하며, 대기 상태에서 재미 요소를 추가. 사용자가 인터넷에서 음식과 칼로리를 검색해 추가 가능.
- **플랫폼**: Flutter 3.22+로 단일 코드베이스 개발, 안드로이드와 iOS 모두 지원.
- **주요 기능**:
  - 사용자 프로필(키, 체중, 성별, 연령, 활동 수준) 입력 및 로컬 저장.
  - 지역 기반 시간대 설정 및 매일 정해진 시간에 체중 체크 알림.
  - 음식 입력 및 칼로리 추적(로컬 데이터베이스 + 사용자 인터넷 검색으로 추가).
  - 도트 아트 아바타(키/체중 기반 동적 변화)와 칼로리 인디케이터의 연동된 애니메이션(체중 체크, 음식 섭취, 세레모니, 대기 행동).
  - 칼로리 인디케이터(일일 권장 칼로리 기준, 초과 시 경고 및 아바타 애니메이션 연동).
  - 운동 칼로리 소모 계산(디바이스 센서 및 건강 API 연동).
  - 체중 변화에 따른 세레모니(체중 감소: 축하, 증가: 재도전).
  - 매일 정오 칼로리 인디케이터 초기화.
- **강화된 기능**:
  - 개인화된 칼로리 계산(Harris-Benedict BMR 공식).
  - 다국어 지원(영어/한국어).
  - 진행 상황 차트 및 동기부여 배지(예: 7일 연속 체중 체크).
  - 오프라인 지원 및 데이터 암호화.
  - 사용자 입력 오류 방지(유효성 검사, 직관적 UI).
  - 아바타 동적 변화(키/체중 기반) 및 대기 시 재미 요소(운동 유도 행동).
  - 인터넷 검색을 통한 음식 및 칼로리 추가 기능.
- **플랫폼 가이드라인 준수**:
  - 2025년 9월 3일 기준 구글 플레이스토어 및 애플 앱스토어 정책 준수(프라이버시, 건강 콘텐츠, 사용자 경험, 인터넷 검색 기능).

## 2. 요구사항 분석

### 2.1 사용자 프로필 설정
- **입력**: 키(cm), 초기 체중(kg), 성별(남/여/기타), 연령(세), 활동 수준(저활동/활동적/매우 활동적).
- **기능**: 
  - Harris-Benedict 공식으로 일일 권장 칼로리(TDEE) 계산:
    - 남성: BMR = 88.362 + (13.397 × 체중) + (4.799 × 키) - (5.677 × 연령)
    - 여성: BMR = 447.593 + (9.247 × 체중) + (3.098 × 키) - (4.330 × 연령)
    - 활동 수준 곱하기(저활동: 1.2, 활동적: 1.55, 매우 활동적: 1.9)로 TDEE 설정.
  - 데이터는 로컬에 암호화 저장(Hive 또는 SharedPreferences). 초기 키/체중으로 아바타 기본 형태 생성.
- **플랫폼 가이드라인 준수**:
  - **애플**: 사용자 데이터 수집 시 명시적 동의(App Tracking Transparency API) 및 프라이버시 정책 링크 필수.
  - **구글**: 데이터 안전 섹션에 데이터 삭제 옵션 제공, 데이터 처리 방식 공개.
- **목적**: 개인화된 칼로리 기준 및 아바타 생성 데이터 제공.

### 2.2 지역 및 시간 설정
- **기능**:
  - Geolocator로 위치 감지, Timezone으로 시간대 설정.
  - 사용자가 선택한 시간(예: 오전 8시)에 체중 체크 알림(Flutter Local Notifications).
  - 매일 정오(12 PM) 칼로리 인디케이터 자동 초기화.
- **플랫폼 가이드라인 준수**:
  - **애플**: 위치 데이터 수집 시 명시적 동의, 사용 목적(시간대 설정) 명확히 설명.
  - **구글**: 위치 데이터 사용 시 데이터 안전 섹션에 공개, 민감한 권한 정당화.
- **목적**: 지역별 시간대에 맞춘 알림 및 일일 리셋 자동화.

### 2.3 음식 입력 및 칼로리 추적
- **기능**:
  - 로컬 데이터베이스(USDA 기반 JSON/SQLite, 1000+ 항목)로 기본 음식 칼로리 제공.
  - 드롭다운/자동완성으로 음식 선택, 미등록 음식은 카테고리 기반 추정(예: "간식" ≈ 200kcal).
  - **인터넷 검색 기능**: 사용자가 웹 검색을 통해 음식명과 칼로리 정보를 직접 입력 가능(예: Google 검색 UI 내장 또는 사용자 수동 입력). 입력한 데이터는 로컬 데이터베이스에 저장되어 재사용 가능.
  - 음식 입력 시 칼로리 인디케이터 증가, TDEE 초과 시 경고 및 아바타 연동 애니메이션.
  - 운동 칼로리 소모(만보계, Google Fit/Apple Health)로 인디케이터 감소, 아바타 애니메이션 반영.
- **플랫폼 가이드라인 준수**:
  - **애플**: 건강 앱은 정확한 정보 제공, 사용자 입력 칼로리 데이터는 신뢰성 경고(예: "사용자 입력 데이터는 정확성을 보장하지 않음") 표시. 인터넷 검색 기능은 WebView 사용 시 애플의 WKWebView 권장, 외부 링크 최소화.
  - **구글**: 건강 콘텐츠는 Play Console에서 건강 앱 선언, 사용자 입력 데이터의 출처 명확히 표시(Health Connect 정책 준수). 인터넷 검색 시 데이터 안전 섹션에 네트워크 사용 공개.
- **목적**: 유료 API 없이 칼로리 관리, 사용자 맞춤 음식 추가, 플랫폼별 건강 데이터 활용.

### 2.4 도트 아트 아바타 및 칼로리 인디케이터 연동
- **기능**:
  - 키/체중/성별 기반 도트 아트 아바타 생성(CustomPainter 또는 Lottie). BMI(체질량지수 = 체중 / (키^2)) 계산으로 형태 동적 변화:
    - BMI <18.5: 날씬(슬림한 몸통, 좁은 픽셀 배열).
    - BMI 18.5-24.9: 정상(균형된 형태).
    - BMI >25: 뚱뚱(둥근 몸통, 추가 픽셀 효과로 볼륨감 표현).
  - 체중 체크 후 갱신: 새 체중 입력 시 BMI 재계산, 아바타 형태 부드럽게 변화(예: 체중 증가 시 몸통 팽창 애니메이션, 감소 시 슬림화).
  - 아바타와 칼로리 인디케이터 연동된 애니메이션:
    - **체중 체크**: 아바타가 저울에 올라가며, 인디케이터가 체중 데이터에 따라 갱신. 아바타 형태가 새 BMI에 맞춰 변화.
    - **음식 섭취**: 아바타가 입을 벌리고 음식 효과 표시, 동시에 인디케이터가 칼로리 증가에 맞춰 실시간으로 채워짐.
    - **칼로리 초과**: 인디케이터가 빨간색으로 변하며, 아바타가 당혹스러운 표정(예: 눈썹 치켜세움, 얼굴 붉힘).
    - **운동 소모**: 인디케이터가 감소하며, 아바타가 활기찬 동작(예: 러닝 포즈).
    - **체중 변화 세레모니**: 감소 시 인디케이터 안정(녹색), 아바타 축하(콘페티)와 슬림화. 증가 시 인디케이터 경고(노란색/빨간색), 아바타 재도전(주먹 쥐기)와 팽창.
    - **대기 상태**: 앱 대기 시 아바타가 랜덤 행동(예: 점핑잭, 스트레칭, "운동 해보세요!" 버블 메시지)으로 사용자 재미 유도. 30초 간격 트리거.
  - 연동 메커니즘: 실시간 상태 관리(Provider/Riverpod)로 칼로리 인디케이터와 아바타 애니메이션 동기화.
- **플랫폼 가이드라인 준수**:
  - **애플**: 애니메이션은 Apple Human Interface Guidelines 준수, 부드럽고 직관적 (2025년 5월 업데이트 준수).
  - **구글**: 성능 문제(예: 애니메이션 지연) 방지, 사용자 친화적 UI.
- **목적**: 아바타 동적 변화와 대기 행동으로 몰입감과 동기부여 제공.

### 2.5 체중 업데이트 및 세레모니
- **기능**:
  - 알림 또는 수동으로 체중 입력, 이전 체중 비교.
  - 체중 감소(>0.5kg): 축하 애니메이션, 인디케이터 안정, 아바타 슬림화.
  - 체중 증가: 재도전 애니메이션 및 동기부여 메시지, 인디케이터 경고, 아바타 팽창.
  - 체중 기록 차트 시각화(FlChart).
- **플랫폼 가이드라인 준수**:
  - **애플**: 앱 기능은 설명된 대로 동작, 오해의 소지 메타데이터 금지.
  - **구글**: 앱 설명 및 스크린샷은 최신 기능 반영.
- **목적**: 진행 상황 추적 및 동기부여 강화.

### 2.6 플랫폼 별 기능
- **안드로이드**: Google Fit으로 운동 데이터(걸음 수, 칼로리 소모) 연동.
- **iOS**: Apple Health로 동일 기능 제공.
- **대체**: 권한 거부 시 수동 운동 입력.
- **플랫폼 가이드라인 준수**:
  - **애플**: Apple Health 연동 시 명시적 동의, 데이터 용도 공개.
  - **구글**: Google Fit 데이터 사용 시 데이터 안전 섹션 명시, Health Connect 정책 준수.
- **목적**: 디바이스 센서 및 건강 API로 사용자 경험 향상.

### 2.7 추가 기능
- **다국어**: 영어/한국어 지원.
- **진행 상황**: 체중/칼로리 추적 차트.
- **동기부여**: 배지(예: 7일 연속 체크).
- **오상태**: 인터넷 없이 모든 기능 동작(인터넷 검색 제외).
- **플랫폼 가이드라인 준수**:
  - **애플**: 메타데이터 정확성, 최신 기능 반영.
  - **구글**: 앱 콘텐츠 페이지에서 네트워크 사용 및 데이터 처리 방식 선언.
- **목적**: 직관적이고 지속적인 사용자 참여 유도.

## 3. 개발 전략

### 3.1 기술 스택
- **프레임워크**: Flutter 3.22+.
- **패키지**:
  - 상태 관리: Provider/Riverpod(아바타-인디케이터 연동).
  - 로컬 저장소: Hive(암호화).
  - 알림: Flutter Local Notifications.
  - 시간대: Timezone.
  - 운동 추적: Pedometer, Flutter Health.
  - 애니메이션: Lottie/AnimatedBuilder(연동된 동작 및 대기 행동).
  - 데이터베이스: Sqflite(음식 데이터 및 사용자 추가 음식).
  - 위치: Geolocator.
  - 차트: FlChart.
  - 인터넷 검색: `url_launcher` 또는 WebView(사용자 음식 추가).

### 3.2 UI/UX 설계
- **주요 화면**:
  - 스플래시: 앱 로고 및 로딩.
  - 프로필 설정: 초기 데이터 입력.
  - 홈: 아바타와 칼로리 인디케이터(연동 애니메이션), 음식 입력 버튼.
  - 음식 입력: 검색/선택 UI, 인터넷 검색 및 칼로리 추가 옵션.
  - 체중 기록: 차트 및 세레모니.
- **칼로리 인디케이터**: LinearProgressIndicator(녹색 <80%, 노란색 80-100%, 빨간색 >100%), 아바타와 동기화.
- **디자인**: 직관적, 최소 클릭으로 기능 접근, 아바타 동적 변화 및 대기 행동 강조.
- **플랫폼 가이드라인 준수**:
  - **애플**: Human Interface Guidelines, 부드러운 애니메이션, WebView 안전 사용.
  - **구글**: 성능 최적화, 사용자 친화적 UI, 네트워크 사용 명확히.

### 3.3 개발 단계
1. **설계 및 설정** (1-2주):
   - Flutter 프로젝트 설정, 패키지 설치.
   - 디렉토리 구조 설계(모델, 서비스, UI, 위젯, 에셋).
2. **프로토타입** (3-4주):
   - 프로필 설정 및 저장.
   - 기본 UI(홈, 아바타-인디케이터 연동, 대기 행동).
3. **핵심 기능** (5-6주):
   - 음식 데이터베이스, 칼로리 계산, 인터넷 검색 및 음식 추가.
   - 알림 및 시간대 설정.
   - 아바타 동적 변화 및 인디케이터 연동 애니메이션.
4. **플랫폼 통합** (7-8주):
   - Google Fit/Apple Health 연동.
   - 만보계 및 칼로리 소모, 아바타 반영.
5. **테스트** (9-10주):
   - 단위 테스트(칼로리 계산, 입력 검증, 연동 애니메이션, 사용자 음식 추가).
   - 통합 테스트(알림, 애니메이션, 오프라인, 인터넷 검색).
   - 사용자 테스트(다양한 디바이스/지역).
6. **배포** (11주):
   - 안드로이드: `flutter build apk`.
   - iOS: `flutter build ios`, Xcode 16+ (iOS 18 SDK).
   - 앱스토어/플레이스토어 제출(건강 면책 조항 포함).

### 3.4 데이터 관리
- **로컬 데이터베이스**: USDA 기반 JSON(1000+ 항목) + 사용자 추가 음식 저장.
- **암호화**: Hive로 데이터 보호.
- **백업**: 클라우드 동기화 제외, 추후 선택적 추가.
- **플랫폼 가이드라인 준수**:
  - **애플**: 프라이버시 정책 링크 필수, 사용자 추가 데이터 처리 명확히.
  - **구글**: 데이터 삭제 옵션 제공, 네트워크 사용 공개.

## 4. 테스트 및 품질 관리
- **단위 테스트**: 칼로리 계산, 입력 검증, 아바타-인디케이터 연동, 사용자 음식 추가.
- **통합 테스트**: 알림, 시간대, 건강 API, 애니메이션 동기화, 인터넷 검색.
- **사용자 테스트**: 안드로이드/iOS, 다양한 지역.
- **오프라인 테스트**: 인터넷 없이 동작 확인(검색 제외).
- **플랫폼 가이드라인 테스트**:
  - **애플**: TestFlight로 테스트, 성능 문제 방지, WebView 안전성 검증.
  - **구글**: Play Console에서 건강 앱 선언, 네트워크 사용 명확히.

## 5. 배포 및 유지보수
- **배포**:
  - 앱스토어: App Store Connect에서 트레이더 상태 제공(EU Digital Services Act), 건강 면책 조항 강조.
  - 플레이스토어: 개발자 인증(2026년 3월부터 필수), 데이터 안전 섹션 완성.
  - 최소 요구사항: 안드로이드 8.0+, iOS 12.0+.
- **유지보수**:
  - 음식 데이터베이스 및 사용자 추가 데이터 주기적 검증.
  - 사용자 피드백 기반 개선.
  - Flutter 버전 업그레이드.
- **확장 가능성**:
  - 소셜 공유.
  - 온디바이스 ML 음식 인식.

## 6. 타임라인 (예상)
- **1-2주**: 설정, UI 프로토타입.
- **3-6주**: 음식 데이터, 인터넷 검색, 알림, 아바타-인디케이터 연동.
- **7-10주**: 플랫폼 통합, 테스트.
- **11주**: 배포.
- **총 기간**: 약 2.5-3개월 (1-2명 개발자).

## 7. 위험 및 대응 방안
- **위험**: 건강 API 제한.
  - 대응: 수동 입력, 명확한 권한 UI.
- **위험**: 데이터베이스 크기(메모리, 사용자 추가 음식 포함).
  - 대응: SQLite 최적화, 페이징.
- **위험**: 애니메이션 성능(저사양 기기).
  - 대응: 간소화 옵션, Lottie 최적화.
- **위험**: 시간대 버그.
  - 대응: Timezone 테스트, 수동 설정.
- **위험**: 인터넷 검색 데이터 부정확성.
  - 대응: 사용자 입력 검증, 신뢰성 경고 표시.
- **위험**: 앱스토어/플레이스토어 거부.
  - 대응: 프라이버시 정책 명확화, 건강 면책 조항, TestFlight/Play Console 테스트.

## 8. 성공 기준
- **기능**: 모든 요구사항 구현, 특히 아바타 동적 변화, 대기 행동, 사용자 음식 추가.
- **사용자 경험**: 직관적 UI, 95% 만족도(베타 테스트).
- **성능**: 로딩 <2초, 애니메이션 60fps.
- **배포**: 앱스토어/플레이스토어 승인, 1000+ 초기 다운로드.

## 9. 구글 플레이스토어 및 애플 앱스토어 가이드라인 준수
- **구글 플레이스토어 (2025년 기준)**:
  - **데이터 안전**: 데이터 수집/삭제 정책 선언, 네트워크 사용(인터넷 검색) 및 사용자 데이터 처리 공개.
  - **건강 콘텐츠**: 건강 앱 선언, 부정확한 정보 금지, 사용자 입력 칼로리 데이터 경고, Health Connect 정책 준수.
  - **개발자 인증**: 2026년 3월부터 필수(법적 이름, 주소, 이메일, 전화번호).
  - **앱 품질**: 충돌/느린 로드 방지, 사용자 친화적 UI.
- **애플 앱스토어 (2025년 기준)**:
  - **프라이버시**: App Tracking Transparency API, 프라이버시 정책 링크 필수, 사용자 추가 음식 데이터 처리 명확히.
  - **건강 콘텐츠**: 정확한 정보, 사용자 입력 데이터 신뢰성 경고, 면책 조항.
  - **UI/UX**: Human Interface Guidelines, WebView(WKWebView) 안전 사용, TestFlight 테스트.
  - **기술 요구사항**: Xcode 16+, iOS 18 SDK(2025년 4월 24일부터 필수).
  - **EU 규정**: Digital Services Act, 트레이더 상태 제공.